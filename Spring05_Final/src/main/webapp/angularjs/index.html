<!DOCTYPE html>
<html data-ng-app="cafeApp">
<head>
<meta charset="UTF-8">
<title>/angularjs/index.html</title>
<!-- animate css 로딩하기 -->
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"/>
<link rel="stylesheet" href="../resources/css/bootstrap.css" />
<style>
	/* .page-change-animation 클래스를 가지고 있는 요소가 만들어 질 때 적용할 css 애니메이션 */
	.page-change-animation.ng-enter{
		animation: fadeIn 0.4s ease-out;
	}
</style>
<script src="../resources/js/angular.min.js"></script>
<script src="../resources/js/angular-route.min.js"></script>
<script src="../resources/js/angular-animate.min.js"></script>
<script>
	var cafeApp=angular.module("cafeApp", ["ngRoute", "ngAnimate"]);
	cafeApp.controller("cafeListCtrl", function($scope, $http, $rootScope){
		//동작유무 실험용
		console.log("cafeListCtrl 동작됨!");
		console.log($scope);
		
		$http({
			url:"/spring05/cafe/ajax_list.do",
			method:"GET"
		}).success(function(data){
			//서버에서 응답한 데이터 콘솔창에 출력해보기
			console.log(data);
			//cafeList 라는 모델에 데이터 대입하기
			$scope.cafeList=data;
		});
		//rootScope 객체를 사용하고 싶다면 해당 컨트롤러(cafeListCtrl)의 함수의 인자값에 $rootScope를 포함하고
		//컨트롤러 영역안에서 사용하면 된다.
		$rootScope.count++;
	});
	
	//$routeParams는 get방식의 요청 파라미터를 추출하는 역할을 한다.
	cafeApp.controller("cafeDetailCtrl", function($scope, $http, $routeParams, $location, $rootScope){ 
		//동작유무 실험용
		console.log("cafeDetailCtrl 동작됨!");
		console.log($scope);
		
		//자세히 보여줄 글번호를 읽어온다. /cafe_detail/:num  =>  /cafe_detail/3
		var num=$routeParams.num;
		//해당 글의 정보를 ajax 요청을 통해서 서버로 부터 얻어온다.
		$http({
			url:"/spring05/cafe/ajax_detail.do",
			method:"get",
			params:{num:num}
		}).success(function(data){
			// {num:1, title:"xxx", content:"xxx", regdate:"xxx"} 이런 형식의 오브젝트(객체)가 data 변수에 저장된다
			$scope.cafeDto=data;
		});
		//목록보기 버튼을 눌렀을 때 호출되는 함수
		$scope.goList=function(){ // "cafe_detail" 이 페이지에서 #/cafe_detail/3 -> #/cafe_list  이러한 요청 변화가 일어나야한다.
			//$location 객체를 이용해서 페이지 내에서 이동하기(location.href를 쓰지 않는 이유는 페이지 전체 로딩이 되기 때문에)
			$location.url("/cafe_list");
		};
		//rootScope 객체를 사용하고 싶다면 해당 컨트롤러(cafeListCtrl)의 함수의 인자값에 $rootScope를 포함하고
		//컨트롤러 영역안에서 사용하면 된다.
		$rootScope.count++;
	});
	
	cafeApp.config(function($routeProvider){
		//$routeProvider 객체를 이용해서 페이지 내에서의 이동 설정하기
		//page, title 키들은 개발자가 임의로 생성한 오브젝트의 키 이름이므로 언제든지 원하는 이름으로 바꿀 수 있다.
		//다만 templateUrl, controller의 이름은 기본으로 제공되는 오브젝트 키 이름이므로 이름을 바꾸면 제 기능을 하지 못한다.
		$routeProvider
		.when("/home", {page: "home", title: "인덱스 페이지", templateUrl:"views/home.html"})
		.when("/cafe_list", {page: "cafe_list", title: "목록보기 페이지", templateUrl:"views/cafe_list.html", controller:"cafeListCtrl"})
		.when("/cafe_detail/:num", {page: "cafe_detail", title: "자세히보기 페이지", templateUrl:"views/cafe_detail.html", controller:"cafeDetailCtrl"})
		.otherwise({redirectTo:"/home"})
	});
	//초기화 되는 시점에 무언가 동작을 하고(준비) 싶을 때 .run() 을 호출해서 함수를 전달한다.
	cafeApp.run(function($rootScope, $route){
		/*
			$rootScope 는 최상위 영역 객체
			$route 페이지 라우트에 관련된 객체
		*/
		//페이지 전환이 완료되었을 때(라우트 변경이 완료 되었을 때) 호출되는 함수 등록
		$rootScope.$on("$routeChangeSuccess", function(){
			//페이지 타이틀 바꿔주기
			document.title = $route.current.title;
			//nav 요소에 active가 동적으로 바뀔 수 있도록 한다.
			$rootScope.currentPage = $route.current.page;
		});
		//최상위 영역 객체에 모델 정의하기
		$rootScope.myName="김구라";
		$rootScope.count=0;
	});
</script>
</head>
<body>
<div class="container">
	<h1>Router 테스트 예제 <strong>{{myName}}|{{count}}</strong></h1>
	<ul class="nav nav-pills">
		<li class="nav-item"><a data-ng-class="{active:currentPage=='home'}" class="nav-link" href="#home">Home</a></li>
		<li class="nav-item"><a data-ng-class="{active:currentPage=='cafe_list'}" class="nav-link" href="#cafe_list">목록보기</a></li>
	</ul>
	<div data-ng-view class="page-change-animation"></div>
</div>
</body>
</html>